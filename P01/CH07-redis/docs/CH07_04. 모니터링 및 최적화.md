# Redis 모니터링 및 최적화 가이드

## 1. Redis 모니터링 도구 설치

### 1.1 Redis Commander 설치
```bash
# Node.js가 설치되어 있어야 합니다
npm install -g redis-commander

# 실행
redis-commander --redis-host localhost --redis-port 6379
```

### 1.2 RedisInsight 설치
1. RedisInsight 다운로드
   - Redis Labs 공식 웹사이트에서 다운로드
   - https://redislabs.com/redis-enterprise/redis-insight/

2. RedisInsight 설정
   - Add Redis Database
   - Host: localhost
   - Port: 6379
   - Name: Redis-Practice

## 2. 성능 모니터링

### 2.1 기본 모니터링 명령어
```bash
# Redis CLI 접속
docker exec -it redis-practice redis-cli

# 메모리 사용량 확인
INFO memory

# 클라이언트 연결 상태
INFO clients

# 명령어 통계
INFO commandstats

# 실시간 모니터링
MONITOR
```

### 2.2 Slow Log 설정 및 확인
```bash
# Slow Log 설정 (10ms 이상 소요되는 명령어 기록)
CONFIG SET slowlog-log-slower-than 10000
CONFIG SET slowlog-max-len 128

# Slow Log 조회
SLOWLOG GET
SLOWLOG LEN
SLOWLOG RESET
```

## 3. 성능 최적화

### 3.1 메모리 최적화
```bash
# 메모리 정책 설정
CONFIG SET maxmemory-policy allkeys-lru

# 메모리 한도 설정
CONFIG SET maxmemory 256mb

# 키 만료 설정 확인
SCAN 0 MATCH * TYPE string
```

### 3.2 Connection Pool 설정
Spring Boot application.yml:
```yaml
spring:
  redis:
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms
```

### 3.3 배치 처리 최적화
```java
@Service
@Slf4j
public class RedisBatchService {
    private final RedisTemplate<String, Object> redisTemplate;

    public void batchProcess(Map<String, Object> dataMap) {
        redisTemplate.executePipelined((RedisCallback<Object>) connection -> {
            dataMap.forEach((key, value) -> {
                byte[] keyBytes = key.getBytes();
                byte[] valueBytes = value.toString().getBytes();
                connection.stringCommands().set(keyBytes, valueBytes);
            });
            return null;
        });
    }
}
```

## 4. 실시간 모니터링 대시보드

### 4.1 Prometheus + Grafana 설정

1. docker-compose.yml에 추가
```yaml
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
```

2. prometheus.yml 설정
```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'spring-redis'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['host.docker.internal:8080']
```

## 5. 성능 테스트

### 5.1 Redis 벤치마크 도구 사용
```bash
# 기본 벤치마크
redis-benchmark -h localhost -p 6379 -n 100000 -c 50

# 특정 명령어 벤치마크
redis-benchmark -t set,get -n 100000 -q

# 파이프라인 벤치마크
redis-benchmark -P 16 -n 100000 -q
```

### 5.2 JMeter 테스트 시나리오

1. Thread Group 설정
   - Number of Threads: 100
   - Ramp-up Period: 10
   - Loop Count: 100

2. HTTP Request 설정
   - 캐시 조회 API 테스트
   - 리더보드 업데이트 테스트

## 6. 모니터링 체크리스트

### 6.1 Daily 점검사항
- [ ] 메모리 사용량 확인
- [ ] 연결된 클라이언트 수 확인
- [ ] 초당 처리 명령어 수 확인
- [ ] Slow Log 확인
- [ ] 키 개수 및 만료 설정 확인

### 6.2 Weekly 점검사항
- [ ] 메모리 fragmention 확인
- [ ] 백업 상태 확인
- [ ] 네트워크 지연시간 확인
- [ ] CPU 사용률 확인
- [ ] 디스크 사용량 확인